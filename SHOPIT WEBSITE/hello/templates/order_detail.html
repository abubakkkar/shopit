{% extends "base.html" %}

{% block title %}Order Details - ShopIt{% endblock %}

{% block body %}
<div style="max-width: 900px; margin: 40px auto; padding: 20px;">
    <h2>Order #{{ order.order_id }}</h2>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0;">
        <!-- Order Status -->
        <div style="border: 1px solid #ddd; padding: 20px; border-radius: 8px;">
            <h3>Order Status</h3>
            <p><strong>Status:</strong> 
                <span style="padding: 5px 10px; border-radius: 20px; 
                    {% if order.status == 'delivered' %}background: #d4edda; color: #155724;
                    {% elif order.status == 'shipped' %}background: #cfe2ff; color: #084298;
                    {% elif order.status == 'cancelled' %}background: #f8d7da; color: #721c24;
                    {% else %}background: #fff3cd; color: #856404;{% endif %}">
                    {{ order.get_status_display }}
                </span>
            </p>
            {% if order.tracking_number %}
            <p><strong>Tracking Number:</strong> {{ order.tracking_number }}</p>
            {% endif %}
            <p><strong>Order Date:</strong> {{ order.created_at|date:"d M Y H:i" }}</p>
        </div>

        <!-- Delivery Info -->
        <div style="border: 1px solid #ddd; padding: 20px; border-radius: 8px;">
            <h3>Delivery Address</h3>
            <p><strong>{{ order.name }}</strong><br>
            {{ order.address }}<br>
            Phone: {{ order.phone }}<br>
            Email: {{ order.email }}</p>
        </div>
    </div>

    <!-- Order Items -->
    <div style="border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin: 20px 0;">
        <h3>Order Items</h3>
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #f5f5f5;">
                    <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Product</th>
                    <th style="padding: 10px; text-align: center; border-bottom: 1px solid #ddd;">Quantity</th>
                    <th style="padding: 10px; text-align: right; border-bottom: 1px solid #ddd;">Price</th>
                    <th style="padding: 10px; text-align: right; border-bottom: 1px solid #ddd;">Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr style="border-bottom: 1px solid #ddd;">
                    <td style="padding: 10px;">{{ item.product.name }}</td>
                    <td style="padding: 10px; text-align: center;">{{ item.quantity }}</td>
                    <td style="padding: 10px; text-align: right;">Rs. {{ item.price }}</td>
                    <td style="padding: 10px; text-align: right;">Rs. {{ item.price|add:item.quantity }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Order Summary -->
    <div style="border: 1px solid #ddd; padding: 20px; border-radius: 8px; max-width: 400px; margin-left: auto;">
        <h3>Order Summary</h3>
        <div style="display: flex; justify-content: space-between; margin: 10px 0;">
            <span>Subtotal:</span>
            <span>Rs. {{ order.total_amount|add:order.discount_amount|add:-100 }}</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin: 10px 0;">
            <span>Delivery Fee:</span>
            <span>Rs. 100</span>
        </div>
        {% if order.discount_amount > 0 %}
        <div style="display: flex; justify-content: space-between; margin: 10px 0; color: #28a745;">
            <span>Discount:</span>
            <span>-Rs. {{ order.discount_amount }}</span>
        </div>
        {% endif %}
        <div style="border-top: 1px solid #ddd; padding-top: 10px; margin-top: 10px; display: flex; justify-content: space-between; font-weight: bold; font-size: 18px;">
            <span>Total:</span>
            <span>Rs. {{ order.total_amount }}</span>
        </div>
    </div>

    <!-- Return Option -->
    {% if order.status == 'delivered' and not returns %}
    <div style="margin-top: 20px; text-align: center;">
        <a href="{% url 'request_return' order.order_id %}" style="padding: 10px 20px; background: #ffc107; color: black; text-decoration: none; border-radius: 5px;">Request Return</a>
    </div>
    {% endif %}

    <!-- Returns -->
    {% if returns %}
    <div style="border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin-top: 20px;">
        <h3>Returns</h3>
        {% for return in returns %}
        <div style="background: #f9f9f9; padding: 15px; margin: 10px 0; border-radius: 5px;">
            <p><strong>Reason:</strong> {{ return.reason }}</p>
            <p><strong>Status:</strong> {{ return.get_status_display }}</p>
            {% if return.refund_amount > 0 %}
            <p><strong>Refund Amount:</strong> Rs. {{ return.refund_amount }}</p>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div style="margin-top: 30px;">
        <a href="{% url 'dashboard' %}" style="padding: 10px 20px; background: #007bff; color: white; text-decoration: none; border-radius: 5px;">‚Üê Back to Dashboard</a>
    </div>
</div>
{% endblock %}
